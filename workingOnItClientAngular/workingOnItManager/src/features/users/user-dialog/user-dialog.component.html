<div class="dialog-header">
  <h2 mat-dialog-title class="dialog-title">
    <mat-icon class="title-icon">{{ isEdit ? 'edit' : 'person_add' }}</mat-icon>
    {{ isEdit ? 'Edit User' : 'Add New User' }}
  </h2>
  <button mat-icon-button (click)="onCancel()" class="close-button">
    <mat-icon>close</mat-icon>
  </button>
</div>

<mat-dialog-content class="dialog-content">
  <form [formGroup]="userForm" class="user-form">
    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Full Name</mat-label>
        <input matInput formControlName="fullName" placeholder="Enter full name">
        <mat-icon matSuffix>person</mat-icon>
        @if (userForm.get('fullName')?.invalid && userForm.get('fullName')?.touched) {
          <mat-error>{{ getErrorMessage('fullName') }}</mat-error>
        }
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Email</mat-label>
        <input matInput type="email" formControlName="email" placeholder="Enter email address">
        <mat-icon matSuffix>email</mat-icon>
        @if (userForm.get('email')?.invalid && userForm.get('email')?.touched) {
          <mat-error>{{ getErrorMessage('email') }}</mat-error>
        }
      </mat-form-field>
    </div>

    @if (!isEdit) {
      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Password</mat-label>
          <input matInput type="password" formControlName="password" placeholder="Enter password">
          <mat-icon matSuffix>lock</mat-icon>
          @if (userForm.get('password')?.invalid && userForm.get('password')?.touched) {
            <mat-error>{{ getErrorMessage('password') }}</mat-error>
          }
        </mat-form-field>
      </div>
    }

    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Role</mat-label>
        <mat-select formControlName="roleId" placeholder="Select role">
          <mat-option [value]="1">
            <div class="role-option">
              <mat-icon>admin_panel_settings</mat-icon>
              <span>Admin</span>
            </div>
          </mat-option>
          <mat-option [value]="2">
            <div class="role-option">
              <mat-icon>person</mat-icon>
              <span>User</span>
            </div>
          </mat-option>
        </mat-select>
        <mat-icon matSuffix>assignment_ind</mat-icon>
        @if (userForm.get('roleId')?.invalid && userForm.get('roleId')?.touched) {
          <mat-error>{{ getErrorMessage('roleId') }}</mat-error>
        }
      </mat-form-field>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions class="dialog-actions">
  <button mat-button (click)="onCancel()" class="cancel-button">
    <mat-icon>cancel</mat-icon>
    Cancel
  </button>
  <button mat-raised-button 
          color="primary" 
          (click)="onSave()" 
          [disabled]="userForm.invalid || isLoading"
          class="save-button">
    @if (isLoading) {
      <mat-spinner diameter="20" class="button-spinner"></mat-spinner>
    } @else {
      <mat-icon>{{ isEdit ? 'save' : 'add' }}</mat-icon>
    }
    {{ isLoading ? 'Saving...' : (isEdit ? 'Update' : 'Create') }}
  </button>
</mat-dialog-actions>
